(function(d){var a=100;d.Validator={};d.Validator.validate=function(h,e){var e=d.extend({},d.Validator.defaults,e);var l={};var k=false;var q={};var n=this;if(h.length==0){return true}var g=function(){if(e.vldOnclick){d(e.vldOnclick).bind("click",function(){var s=n.validateAll();if(s==false){for(var t=0;t<h.length;t++){if(h[t].passed==false){d("#"+h[t].field).focus();return false}}}return s})}if(e.vldOnBlur||e.vldOnEnter){for(var r=0;r<h.length;r++){if(e.vldOnBlur){d(document).delegate("#"+h[r].field,"blur",{index:r,field:h[r].field},f)}if(e.vldOnEnter){d(document).delegate("#"+h[r].field,"keyup",{index:r,field:h[r].field},i)}}}if(e.trigger){for(var r=0;r<e.trigger.length;r++){d(e.trigger[r].elm).bind(e.trigger[r].event,n.validateAll)}}for(var r=0;r<h.length;r++){h[r].passed=true;if(h[r].rule.constructor==RegExp||(typeof h[r].rule)=="function"){}else{if(h[r].rule.indexOf("#")!=-1){k=true}}if(h[r].limiter){d("#"+h[r].field).limiter(h[r].limiter)}}};this.isPassed=function(){for(var r=0;r<h.length;r++){if(!h[r].passed){return false}}return true};function i(r){if(r.keyCode==13){return f(r)}}this.validateAll=function(){var s=true;for(var t=0;t<h.length;t++){var r=p(h[t]);s=r==false?false:s}return s};function j(s){if(!q[s.field]){q[s.field]=[s];for(var u=0;u<h.length;u++){if(h[u].rule.constructor!=RegExp&&(typeof h[u].rule)!="function"&&h[u].rule.indexOf("#"+s.field)!=-1){q[s.field].push(h[u])}}}var r=true;for(var t=0;t<q[s.field].length;t++){var r=p(q[s.field][t])==false?false:r}return r}function p(u){var z=u.field;var s=u.msg?u.msg:e.defaultMsg;var C=u.errorLoc;var A=d("#"+z)[0];var B=A.value;var t=u.tipOffset&&u.tipOffset.left?u.tipOffset.left:0;var r=u.tipOffset&&u.tipOffset.top?u.tipOffset.top:0;var v=u.tipDir;if(typeof u.rule=="function"){var D=u.rule();if(D){x()}else{w()}return D}if(u.rule.constructor==RegExp){var D=u.rule.test(B);u.rule.lastIndex=0;if(D){x()}else{w()}return D}var y=u.rule;if(y.contains("#")){y=y.replace(/#[a-zA-Z0-9_]+/ig,function(G,E,F){return d(G)[0].value+""})}VldRulesLib.validate(B,y,"",s,x,w);function x(){u.passed=true;if(C){if(C.indexOf("#")!=-1){d(C).html("")}else{d("#"+C).html("")}}if(v||e.tipDir){d("#"+z+"_errTip").remove()}l[z]="";d("#"+z).removeClass(e.errorClass);m()}function w(){u.passed=false;if(C){if(C.indexOf("#")!=-1){d(C).html(s)}else{d("#"+C).html(s)}}else{l[z]=s}d("#"+z).addClass(e.errorClass);if(e.checkOnError){if(!u.interval){u.interval=setInterval(o,a,u)}}if(v||e.tipDir){d("#"+z+"_errTip").remove();var E=d(Mustache.render(e.errTipTpl,{id:z+"_errTip",zindex:d.Validator.getZIndex(d("#"+z)),message:s}));var F=e.parent?e.parent:"body";d(F).append(E);d.Validator.setTipLoc(z,E,v,t,r,e)}m()}}function f(r){if(h[r.data.index].interval){h[r.data.index].interval=null;window.clearInterval(h[r.data.index].interval)}if(k==false){return p(h[r.data.index])}else{return j(h[r.data.index])}}function o(r){if(k==false){return p(r)}else{return j(r)}}function m(){var s="";for(var r in l){if(l[r]!=""){s+=l[r];s+="<br/>"}}if(e.errorField){d("#"+e.errorField).html(s)}}g()};d.Validator.getElmLoc=function(f){var e={};var g=d("#"+f);e.left=g.offset().left;e.top=g.offset().top;e.width=g.width()+4;e.height=g.height()+6;return e};d.Validator.setTipLoc=function(q,o,k,j,m,f){if(f==null||f==undefined){f={tipDir:null,tipOffset:null}}if(!f.tipDir&&!k){return}var n=d.Validator.getElmLoc(q);var l=o[0].offsetWidth;var e=o[0].offsetHeight;var p={};var g=(f.tipOffset&&f.tipOffset.top?f.tipOffset.top:0)+(m?m:0);var i=(f.tipOffset&&f.tipOffset.left?f.tipOffset.left:0)+(j?j:0);var h=k?k:f.tipDir;if(h=="up"){p.top=n.top-e+g;p.left=n.left+i}else{if(h=="left"){p.top=n.top+(n.height-e)/2+g;p.left=n.left-l+i}else{if(h=="down"){p.top=n.top+n.height+g;p.left=n.left+i}else{if(h=="right"){p.top=n.top+(n.height-e)/2+g;p.left=n.left+n.width+i}else{console.log("tipDir\u7481\u5267\u7586\u95bf\u6b12\ue1e4\u951b\ufffd");return}}}}o.offset(p)};d.Validator.parseRule=function(k){if(k.constructor==RegExp||typeof k=="function"){return null}var j=[];var l=[];if(k.indexOf("&")!=-1){l=k.split("&");j.push({rel:"and"})}else{if(k.indexOf("|")!=-1){l=k.split("|");j.push({rel:"or"})}else{l.push(k)}}for(var h=0;h<l.length;h++){var e=l[h].match(/(\w+)(\[([\s\S]+)\])?/);var g=e[1];var f=e[3];if(!d.Validator.rulesTable[g]){console.log("\u7459\u52eb\u57af\u95bf\u6b12\ue1e4\u951b\ufffd");return false}j.push({rule:g,args:f})}return j};d.Validator.getZIndex=function(e){if(e[0].tagName=="BODY"){return 1}var f=e.css("z-index");if(f=="auto"){f=d.Validator.getZIndex(e.parent())}return f};d.Validator.defaults={vldOnclick:null,vldOnBlur:false,vldOnEnter:false,checkOnError:true,errorFiled:null,errorClass:"",errTipTpl:"<div class='errorTip' id='{{id}}' style='z-index:{{zindex}};position:absolute;'>{{message}}</div>",tipDir:"right",tipOffset:null,defaultMsg:"\u6748\u64b3\u53c6\u93c8\u590e\ue1e4\u951b\u5c83\ue1ec\u95b2\u5d86\u67ca\u6748\u64b3\u53c6",trigger:null,parent:null};d.fn.validator=function(e){return new b(this,e)};function b(p,j){j=d.extend({},d.fn.validator.defaults,j);var m=this;var e=p.attr("id");var g=j.msg;var o=j.errorLoc;var h=j.tipOffset&&j.tipOffset.left?j.tipOffset.left:0;var f=j.tipOffset&&j.tipOffset.top?j.tipOffset.top:0;var l=j.tipDir;j.errTip=null;m.validate=function(){var s=p[0].value;if(typeof j.rule=="function"){var i=j.rule();if(i){r()}else{q()}return i}if(j.rule.constructor==RegExp){var i=j.rule.test(s);j.rule.lastIndex=0;if(i){r()}else{q()}return i}var t=j.rule;if(t.contains("#")){t=t.replace(/#[a-zA-Z0-9_]+/ig,function(w,u,v){return d(w)[0].value+""})}VldRulesLib.validate(s,t,"",g,r,q);function r(){j.passed=true;if(o){if(o.indexOf("#")!=-1){d(o).html("")}else{d("#"+o).html("")}}if(l){d("#"+e+"_errTip").remove()}p.removeClass(j.errorClass);d(o).html(j.msg)}function q(){j.passed=false;if(o){if(o.indexOf("#")!=-1){d(o).html(g)}else{d("#"+o).html(g)}}p.addClass(j.errorClass);if(j.checkOnError){if(!j.interval){j.interval=setInterval(m.validate,a)}}if(l){d("#"+e+"_errTip").remove();var u=d(Mustache.render(j.errTipTpl,{id:e+"_errTip",zindex:d.Validator.getZIndex(d("#"+e)),message:g}));j.errTip=u;var v=j.parent?j.parent:"body";d(v).append(u);d.Validator.setTipLoc(e,u,j.tipDir,h,f)}}};this.check=function(){if(j.interval){j.interval=null;window.clearInterval(j.interval)}m.validate()};m.resetTip=function(){if(j.errTip){d.Validator.setTipLoc(e,j.errTip,j.tipDir,h,f)}};if(j.trigger){for(var k=0;k<j.trigger.length;k++){var n=j.trigger[k].elm?j.trigger[k].elm:"#"+p.attr("id");d(n).bind(j.trigger[k].event,m.check)}}}d.fn.validator.defaults={tipDir:"right",checkOnError:true,tipOffset:{top:0,left:0},errTipTpl:"<div class='errorTip' id='{{id}}' style='z-index:{{zindex}};position:absolute;'>{{message}}</div>",msg:"\u6748\u64b3\u53c6\u93c8\u590e\ue1e4\u951b\u5c83\ue1ec\u95b2\u5d86\u67ca\u6748\u64b3\u53c6"};d.Validator.dpShowErrClass=null;d.Validator.dpAutoListen=true;d.Validator.dpInterval=100;d.Validator.dpItemsInterval={};d.Validator.dpValidate=function(g){var f={};if(arguments.length==1){if(typeof g=="string"){return c(g)}else{if(typeof g=="object"&&g instanceof Array){for(var e=0;e<g.length;e++){f[g[e]]=c(g[e])}return f}}}else{if(arguments.length>1){for(var e=0;e<arguments.length;e++){if(typeof arguments[e]=="string"){f[arguments[e]]=c(arguments[e])}else{f[arguments[e]]=undefined}}return f}}};function c(g){var m;var j;var e;var l;var k;m=d("#"+g);if(!m){return true}j=m.find("input");if(!j){return true}e=j.attr("data-pattern");if(!e){return true}k=j[0].value;var h=e;if(h.contains("#")){h=h.replace(/#[a-zA-Z0-9_]+/ig,function(p,n,o){return d(p)[0].value+""})}VldRulesLib.validate(k,h,"","",i,f);function i(){if(d.Validator.dpItemsInterval[g]){window.clearInterval(d.Validator.dpItemsInterval[g]);d.Validator.dpItemsInterval[g]=null}m.removeClass(d.Validator.dpShowErrClass)}function f(){if(!d.Validator.dpItemsInterval[g]){d.Validator.dpItemsInterval[g]=setInterval(c,d.Validator.dpInterval,g)}m.addClass(d.Validator.dpShowErrClass)}}})(jQuery);
