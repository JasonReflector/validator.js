define("Validator",function(c,b,e){c("jquery");var g=c("VldRulesLib");var a=c("limiter");var h=100;var f=true;$.Validator={};$.Validator.defaults={vldOnclick:null,vldOnBlur:false,vldOnEnter:false,checkOnError:true,timer:true,errorFiled:null,errorClass:"",errorLocClass:"",errTipTpl:"<div class='errorTip' id='{{id}}' style='z-index:{{zindex}};position:absolute;'>{{message}}</div>",tipDir:"right",tipOffset:null,defaultMsg:"输入有误，请重新输入",trigger:null,parent:"body"};$.Validator.validator=function(i,j){if(!i||!i.length){return true}this.opts=$.extend({},$.Validator.defaults,j);this.errorMsg={};this.hasRel=false;this.relations={};this.dynamicVlds=[];this.validations=i;this._init()};var d=$.Validator.validator;d.prototype._init=function(){var q=this.opts;var p=this.errorMsg;var k=this.relations;var o=this.dynamicVlds;var n=this.validations;var r=this;q.$button=$(q.vldOnclick);q.$errorField=$(q.errorField);q.$parent=$(q.parent);for(var m=0;m<n.length;m++){if(n[m].field.constructor==jQuery&&n[m].field.length>1){for(var l=0;l<n[m].field.length;l++){n.push(vld)}n.shift(m)}}for(var m=0;m<n.length;m++){n[m].passed=true;if(n[m].field.constructor==jQuery){n[m].$el=n[m].field;n[m].randomId=$.Validator.randomString(10)}else{n[m].$el=$("#"+n[m].field);n[m].randomId=$.Validator.randomString(10)}if(!n[m].$el.attr("id")){n[m].$el.attr("id",n[m].randomId)}n[m].$errorLoc=$(n[m].errorLoc);if(n[m].limiter){n[m].$el.limiter(n[m].limiter)}if(n[m].dynamicVld){o.push(n[m])}}if(q.$button){q.$button.bind("click",function(){r.validateAll()})}if(q.vldOnBlur||q.vldOnEnter){for(var m=0;m<n.length;m++){if(q.vldOnBlur){q.$parent.delegate(n[m].$el.selector,"blur",{index:m,field:n[m].field},function(i){r.check(i.data.index)})}if(q.vldOnEnter){q.$parent.delegate(n[m].$el.selector,"keyup",{index:m,field:n[m].field},function(i){r.onEnterHandler(i)})}}}if(q.trigger){for(var m=0;m<q.trigger.length;m++){$(q.trigger[m].elm).bind(q.trigger[m].event,function(){r.validateAll()})}}if(q.timer){if(o.length!=0){setInterval(function(){for(var j=0;j<o.length;j++){r.dynamicCheck(o[j])}},h)}if(q.checkOnError){setInterval(function(){for(var j=0;j<n.length;j++){if(n[j].onError){if(r.hasRel){r.validateRel(n[j])}else{r.validate(n[j])}}}},h)}}else{for(var m=0;m<n.length;m++){if(n[m].dynamicVld){r.initDynamicVld(n[m])}}}};d.prototype.initDynamicVld=function(i){var j=this;if($.browser.msie){if(f){j.opts.$parent.delegate(i.$el.selector,"keydown",{vld:i},function(k){setTimeout(function(){j.dynamicCheck(k.data.vld)},0)})}else{i.$el.on("keydown",{vld:i},function(k){setTimeout(function(){j.dynamicCheck(k.data.vld)},0)})}}else{if(f){j.opts.$parent.delegate(i.$el.selector,"input",{vld:i},function(k){setTimeout(function(){j.dynamicCheck(k.data.vld)},0)})}else{i.$el.on("input",{vld:i},function(k){setTimeout(function(){j.dynamicCheck(k.data.vld)},0)})}}if(f){j.opts.$parent.delegate(i.$el.selector,"paste",{vld:i},function(k){setTimeout(function(){j.dynamicCheck(k.data.vld)},0)})}else{i.$el.on("paste",{vld:i},function(k){setTimeout(function(){j.dynamicCheck(k.data.vld)},0)})}};d.prototype.dynamicCheck=function(i){this.validate(i)};d.prototype.check=function(i){if(this.validations[i].onError){this.validations[i].onError=false}if(this.hasRel==false){return this.validate(this.validations[i])}else{return this.validateRel(this.validations[i])}};d.prototype.onEnterHandler=function(i){if(i.keyCode==13){return this.check(i.data.index)}};d.prototype.isPassed=function(){for(var j=0;j<this.validations.length;j++){if(!this.validations[j].passed){return false}}return true};d.prototype.results=function(){return $.map(this.validations,function(j,i){return{field:j.field,passed:j.passed}})};d.prototype.validateAll=function(){var m=this.validations;var k=true;for(var l=0;l<m.length;l++){var j=this.validate(m[l]);k=j==false?false:k}if(!k){for(var l=0;l<m.length;l++){if(m[l].passed==false){m[l].$el.focus();return false}}}return k};d.prototype.validateRel=function(i){};d.prototype.validate=function(s){var u=this.opts;var j=this.errorMsg;var n=this.relations;var x=this.dynamicVlds;var k=this.validations;var z=this;var i=s.field;var B=s.randomId;var l=s.msg?s.msg:u.defaultMsg;var m=s.errorLoc;var C=s.$el;var r=s.$el[0];var w=r.value;var p=s.tipOffset&&s.tipOffset.left?s.tipOffset.left:0;var A=s.tipOffset&&s.tipOffset.top?s.tipOffset.top:0;var v=s.tipDir;if(typeof s.rule=="function"){var q=s.rule();if(q){t()}else{y()}return q}if(s.rule.constructor==RegExp){var q=s.rule.test(w);s.rule.lastIndex=0;if(q){t()}else{y()}return q}var o=s.rule;if(o.indexOf("#")!=-1){o=o.replace(/#[a-zA-Z0-9_]+/ig,function(F,D,E){return $(F)[0].value+" "})}if(arguments.callee.caller==z.dynamicCheck){var q=g.validate(w,o,"",l,t,y);if(!q.result){r.value=q.revisedVal}}else{g.validate(w,o,"",l,t,y)}function t(){s.passed=true;if(m){s.$errorLoc.html("");if(u.errorLocClass){s.$errorLoc.removeClass(u.errorLocClass)}else{s.$errorLoc.hide()}}if(v||u.tipDir){$("#"+B+"_errTip").remove()}j[B]="";C.removeClass(u.errorClass);z.showInErrorField()}function y(){s.passed=false;s.onError=true;if(m){s.$errorLoc.html(l);if(u.errorLocClass){s.$errorLoc.addClass(u.errorLocClass)}else{s.$errorLoc.show()}}else{j[B]=l}C.addClass(u.errorClass);if(u.checkOnError&&!u.timer&&!s.binded){s.binded=true;if($.browser.msie){if(f){u.$parent.delegate(C.selector,"keydown",{vld:s},function(E){setTimeout(function(){z.validate(E.data.vld)},0)})}else{C.on("keydown",{vld:s},function(E){setTimeout(function(){z.validate(E.data.vld)},0)})}}else{if(f){u.$parent.delegate(C.selector,"input",{vld:s},function(E){setTimeout(function(){z.validate(E.data.vld)},0)})}else{C.on("input",{vld:s},function(E){setTimeout(function(){z.validate(E.data.vld)},0)})}}if(f){u.$parent.delegate(C.selector,"paste",{vld:s},function(E){setTimeout(function(){z.validate(E.data.vld)},0)})}else{C.on("paste",{vld:s},function(E){setTimeout(function(){z.validate(E.data.vld)},0)})}}if(v||u.tipDir){$("#"+B+"_errTip").remove();var D=$(u.errTipTpl.replace("{{id}}",B+"_errTip").replace("{{zindex}}",$.Validator.getZIndex(C)).replace("{{message}}",l));u.$parent.append(D);$.Validator.setTipLoc(C,D,v,p,A,u)}z.showInErrorField()}};d.prototype.showInErrorField=function(){var k=this.errorMsg;var j=this.opts;var l="";for(var i in k){if(k[i]!=""){l+=k[i];l+="<br/>"}}if(j.errorField){j.$errorField.html(l)}};$.Validator.getElmLoc=function(j){var i={};var k=j;i.left=k.offset().left;i.top=k.offset().top;i.width=k.width()+4;i.height=k.height()+6;return i};$.Validator.setTipLoc=function(u,s,o,n,q,j){if(j==null||j==undefined){j={tipDir:null,tipOffset:null}}if(!j.tipDir&&!o){return}var r=$.Validator.getElmLoc(u);var p=s[0].offsetWidth;var i=s[0].offsetHeight;var t={};var k=(j.tipOffset&&j.tipOffset.top?j.tipOffset.top:0)+(q?q:0);var m=(j.tipOffset&&j.tipOffset.left?j.tipOffset.left:0)+(n?n:0);var l=o?o:j.tipDir;if(l=="up"){t.top=r.top-i+k;t.left=r.left+m}else{if(l=="left"){t.top=r.top+(r.height-i)/2+k;t.left=r.left-p+m}else{if(l=="down"){t.top=r.top+r.height+k;t.left=r.left+m}else{if(l=="right"){t.top=r.top+(r.height-i)/2+k;t.left=r.left+r.width+m}else{console.log("tipDir设置错误！");return}}}}s.offset(t)};$.Validator.getZIndex=function(i){if(i[0].tagName=="BODY"){return 1}var j=i.css("z-index");if(j=="auto"){j=$.Validator.getZIndex(i.parent())}return j};$.Validator.randomString=function(l){var k="0123456789ABCDEFGHIJKLMNOPQRSTUVWXTZabcdefghiklmnopqrstuvwxyz".split("");if(!l){l=Math.floor(Math.random()*k.length)}var m="";for(var j=0;j<l;j++){m+=k[Math.floor(Math.random()*k.length)]}return m};$.fn.validator=function(i){i.field=this;var j=new $.Validator.validator(i,i);return this};e.exports=d;window.Validator=d});