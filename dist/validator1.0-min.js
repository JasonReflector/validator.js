var checkInterval=100;var delegate=true;var browser={ie:!$.support.boxModel};$.Validator={};$.Validator.defaults={vldOnclick:null,vldOnBlur:false,vldOnEnter:false,checkOnError:true,timer:true,errorFiled:null,errorClass:"",errorLocClass:"",errTipTpl:"<div class='errorTip' id='{{id}}' style='z-index:{{zindex}};position:absolute;'>{{message}}</div>",tipDir:"right",tipOffset:null,defaultMsg:"输入有误，请重新输入",trigger:null,parent:"body"};$.Validator.validator=function(a,b){this.opts=$.extend({},$.Validator.defaults,b);this.errorMsg={};this.hasRel=false;this.relations={};this._this=this;this.dynamicVlds=[];this.validations=a;if(a.length==0){return true}this.start()};var Validator=$.Validator.validator;Validator.prototype.start=function(){var a=this.opts;var e=this.errorMsg;var k=this.relations;var g=this.dynamicVlds;var b=this.validations;var f=this;for(var d=0;d<b.length;d++){if(b[d].field.constructor==jQuery&&b[d].field.length>1){for(var c=0;c<b[d].field.length;c++){var h=$.extend({},b[d]);if(!b[d].field[c].getAttribute("id")){b[d].field[c].setAttribute("id",$.Validator.randomString(10))}h.field=$(b[d].field.selector+"#"+b[d].field[c].getAttribute("id"));b.push(h)}b.shift(d)}}for(var d=0;d<b.length;d++){b[d].passed=true;if(b[d].field.constructor==jQuery){b[d].$el=b[d].field;b[d].randomId=$.Validator.randomString(10)}else{b[d].$el=$("#"+b[d].field);b[d].randomId=$.Validator.randomString(10)}if(!b[d].$el.attr("id")){b[d].$el.attr("id",b[d].randomId)}if(b[d].limiter){b[d].$el.limiter(b[d].limiter)}if(b[d].dynamicVld){g.push(b[d])}}if(a.vldOnclick){$(a.vldOnclick).bind("click",function(){f.validateAll()})}if(a.vldOnBlur||a.vldOnEnter){for(var d=0;d<b.length;d++){if(a.vldOnBlur){$(a.parent).delegate(b[d].$el.selector,"blur",{index:d,field:b[d].field},function(i){f.check(i.data.index)})}if(a.vldOnEnter){$(a.parent).delegate(b[d].$el.selector,"keyup",{index:d,field:b[d].field},function(i){f.onEnterHandler(i)})}}}if(a.trigger){for(var d=0;d<a.trigger.length;d++){$(a.trigger[d].elm).bind(a.trigger[d].event,function(){f.validateAll()})}}if(a.timer){if(g.length!=0){setInterval(function(){for(var j=0;j<g.length;j++){f.dynamicCheck(g[j])}},checkInterval)}if(a.checkOnError){setInterval(function(){for(var j=0;j<b.length;j++){if(b[j].onError){if(f.hasRel){f.validateRel(b[j])}else{f.validate(b[j])}}}},checkInterval)}}else{for(var d=0;d<b.length;d++){if(b[d].dynamicVld){f.initDynamicVld(b[d])}}}};Validator.prototype.initDynamicVld=function(a){var b=this;if(browser.ie){if(delegate){$(b.opts.parent).delegate(a.$el.selector,"keydown",{vld:a},function(c){setTimeout(function(){b.dynamicCheck(c.data.vld)},0)})}else{a.$el.on("keydown",{vld:a},function(c){setTimeout(function(){b.dynamicCheck(c.data.vld)},0)})}}else{if(delegate){$(b.opts.parent).delegate(a.$el.selector,"input",{vld:a},function(c){setTimeout(function(){b.dynamicCheck(c.data.vld)},0)})}else{a.$el.on("input",{vld:a},function(c){setTimeout(function(){b.dynamicCheck(c.data.vld)},0)})}}if(delegate){$(b.opts.parent).delegate(a.$el.selector,"paste",{vld:a},function(c){setTimeout(function(){b.dynamicCheck(c.data.vld)},0)})}else{a.$el.on("paste",{vld:a},function(c){setTimeout(function(){b.dynamicCheck(c.data.vld)},0)})}};Validator.prototype.dynamicCheck=function(a){this.validate(a)};Validator.prototype.check=function(a){if(this.validations[a].onError){this.validations[a].onError=false}if(this.hasRel==false){return this.validate(this.validations[a])}else{return this.validateRel(this.validations[a])}};Validator.prototype.onEnterHandler=function(a){if(a.keyCode==13){return this.check(a.data.index)}};Validator.prototype.isPassed=function(){for(var a=0;a<this.validations.length;a++){if(!this.validations[a].passed){return false}}return true};Validator.prototype.validateAll=function(){var d=this.validations;var b=true;for(var c=0;c<d.length;c++){var a=this.validate(d[c]);b=a==false?false:b}if(!b){for(var c=0;c<d.length;c++){if(d[c].passed==false){$(d[c].$el).focus();return false}}}return b};Validator.prototype.validateRel=function(a){};Validator.prototype.validate=function(k){var m=this.opts;var b=this.errorMsg;var f=this.relations;var p=this.dynamicVlds;var c=this.validations;var r=this;var a=k.field;var t=k.randomId;var d=k.msg?k.msg:m.defaultMsg;var e=k.errorLoc;var u=k.$el;var j=k.$el[0];var o=j.value;var h=k.tipOffset&&k.tipOffset.left?k.tipOffset.left:0;var s=k.tipOffset&&k.tipOffset.top?k.tipOffset.top:0;var n=k.tipDir;if(typeof k.rule=="function"){var i=k.rule();if(i){l()}else{q()}return i}if(k.rule.constructor==RegExp){var i=k.rule.test(o);k.rule.lastIndex=0;if(i){l()}else{q()}return i}var g=k.rule;if(g.indexOf("#")!=-1){g=g.replace(/#[a-zA-Z0-9_]+/ig,function(x,v,w){return"0"+$(x)[0].value+""})}if(arguments.callee.caller==r.dynamicCheck){var i=VldRulesLib.validate(o,g,"",d,l,q);if(!i.result){j.value=i.revisedVal}}else{VldRulesLib.validate(o,g,"",d,l,q)}function l(){k.passed=true;if(e){var v=null;if(e.indexOf("#")!=-1){v=$(e)}else{v=$("#"+e)}v.html("");if(m.errorLocClass){v.removeClass(m.errorLocClass)}else{v.hide()}}if(n||m.tipDir){$("#"+t+"_errTip").remove()}b[t]="";u.removeClass(m.errorClass);r.showInErrorField()}function q(){k.passed=false;k.onError=true;if(e){var w=null;if(e.indexOf("#")!=-1){w=$(e)}else{w=$("#"+e)}w.html(d);if(m.errorLocClass){w.addClass(m.errorLocClass)}else{w.show()}}else{b[t]=d}u.addClass(m.errorClass);if(m.checkOnError&&!m.timer&&!k.binded){k.binded=true;if(browser.ie){if(delegate){$(m.parent).delegate(u.selector,"keydown",{vld:k},function(y){setTimeout(function(){r.validate(y.data.vld)},0)})}else{u.on("keydown",{vld:k},function(y){setTimeout(function(){r.validate(y.data.vld)},0)})}}else{if(delegate){$(m.parent).delegate(u.selector,"input",{vld:k},function(y){setTimeout(function(){r.validate(y.data.vld)},0)})}else{u.on("input",{vld:k},function(y){setTimeout(function(){r.validate(y.data.vld)},0)})}}if(delegate){$(m.parent).delegate(u.selector,"paste",{vld:k},function(y){setTimeout(function(){r.validate(y.data.vld)},0)})}else{u.on("paste",{vld:k},function(y){setTimeout(function(){r.validate(y.data.vld)},0)})}}if(n||m.tipDir){$("#"+t+"_errTip").remove();var v=$(m.errTipTpl.replace("{{id}}",t+"_errTip").replace("{{zindex}}",$.Validator.getZIndex(u)).replace("{{message}}",d));var x=m.parent?m.parent:"body";$(x).append(v);$.Validator.setTipLoc(u,v,n,h,s,m)}r.showInErrorField()}};Validator.prototype.showInErrorField=function(){var c=this.errorMsg;var b=this.opts;var d="";for(var a in c){if(c[a]!=""){d+=c[a];d+="<br/>"}}if(b.errorField){$("#"+b.errorField).html(d)}};$.Validator.getElmLoc=function(b){var a={};var c=b;a.left=c.offset().left;a.top=c.offset().top;a.width=c.width()+4;a.height=c.height()+6;return a};$.Validator.setTipLoc=function(m,k,g,f,i,b){if(b==null||b==undefined){b={tipDir:null,tipOffset:null}}if(!b.tipDir&&!g){return}var j=$.Validator.getElmLoc(m);var h=k[0].offsetWidth;var a=k[0].offsetHeight;var l={};var c=(b.tipOffset&&b.tipOffset.top?b.tipOffset.top:0)+(i?i:0);var e=(b.tipOffset&&b.tipOffset.left?b.tipOffset.left:0)+(f?f:0);var d=g?g:b.tipDir;if(d=="up"){l.top=j.top-a+c;l.left=j.left+e}else{if(d=="left"){l.top=j.top+(j.height-a)/2+c;l.left=j.left-h+e}else{if(d=="down"){l.top=j.top+j.height+c;l.left=j.left+e}else{if(d=="right"){l.top=j.top+(j.height-a)/2+c;l.left=j.left+j.width+e}else{console.log("tipDir设置错误！");return}}}}k.offset(l)};$.Validator.getZIndex=function(a){if(a[0].tagName=="BODY"){return 1}var b=a.css("z-index");if(b=="auto"){b=$.Validator.getZIndex(a.parent())}return b};$.Validator.randomString=function(c){var b="0123456789ABCDEFGHIJKLMNOPQRSTUVWXTZabcdefghiklmnopqrstuvwxyz".split("");if(!c){c=Math.floor(Math.random()*b.length)}var d="";for(var a=0;a<c;a++){d+=b[Math.floor(Math.random()*b.length)]}return d};$.fn.validator=function(a){a.field=this;return new $.Validator.validator(a,a)};